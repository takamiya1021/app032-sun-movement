# 📋 要件定義書：No.32「太陽の動き表示」

**作成日**: 2025-01-13
**バージョン**: 1.0
**アプリ番号**: 32

---

## 1. プロジェクト概要

### 1.1 アプリ名
**太陽の動き表示（Sun Movement Viewer）**

### 1.2 目的・課題
- **解決したい課題**:
  - 曇りの日でも太陽の位置を知りたい
  - 世界各地の太陽の動きの違いを確認したい（白夜・極夜等）
  - 季節による太陽の高さ変化を理解したい
- **ターゲットユーザー**: 天文・自然現象に興味がある人、写真撮影愛好家
- **利用シーン**: 興味本位で太陽の動きを確認、写真撮影計画、季節変化の理解
- **コンセプト**: エンターテインメント + 実用性

### 1.3 成功基準
- 直感的に太陽の位置・動きがわかる
- 世界各地の太陽の動き比較ができる
- 時間帯に応じた美しいビジュアル体験
- 実用情報（日の出・日の入り等）が正確

---

## 2. 必須要件（中期以降の方針）

### 2.1 AI内蔵アプリケーション
- ✅ Google AI Studio API使用（31番と同じ）
- ✅ 太陽にまつわる豆知識・神話生成
- ✅ その日の太陽に合わせたメッセージ生成
- ✅ 日焼け対策・紫外線アドバイス生成
- ✅ 写真撮影ベストタイミング提案

### 2.2 PWA標準実装
- ✅ オフライン対応
  - **太陽の計算**: オフラインでも動作
  - **AI生成**: オンライン必須
- ✅ インストール可能
- ✅ レスポンシブデザイン

### 2.3 既存アプリとの連携
- ✅ **31番「月の満ち欠け表示」と連携**
  - 天文系アプリ同士の統合
  - Canvas描画ロジックの流用
  - デザイン・UI統一
  - 共通ナビゲーション
  - 将来拡張：月と太陽の位置関係表示

---

## 3. 機能仕様

### 3.1 コア機能

#### 3.1.1 日付・時間選択
- **日付選択**: カレンダー選択（月単位表示）
- **時間選択**: スライダーまたはドロップダウン（0時〜24時）
- **対応期間**: ±100年間（1925年〜2125年）
- **デフォルト**: 今日の日付、現在時刻
- **操作**:
  - 月単位カレンダーUI
  - 前後矢印ボタン：1日ずつ移動
  - 時間スライダー：1時間刻み（オプション：15分刻み）

#### 3.1.2 位置情報選択
- **主要都市選択**（ドロップダウン）:
  - 東京
  - ロンドン
  - ニューヨーク
  - シドニー
  - 北京
  - シンガポール
  - その他主要都市（10〜20都市）
- **緯度経度手動入力**:
  - 緯度: -90° 〜 90°
  - 経度: -180° 〜 180°
  - 入力バリデーション

#### 3.1.3 太陽の動き表示
- **描画方式**: Canvas描画
- **太陽のサイズ**: 画面の15%〜20%（月より小さめ）
- **太陽の色味**: リアル志向だがちょっとファンタジー寄り（暖色系、発光効果）
- **背景**: 時間帯に応じた空の色変化
  - 夜明け前：深い青〜紫
  - 朝焼け：オレンジ〜ピンク
  - 昼：明るい青空
  - 夕焼け：オレンジ〜赤
  - 夜：濃紺〜黒
- **太陽の軌跡**:
  - 東から西への移動経路を弧で表示
  - 現在時刻の位置をハイライト
  - 日の出・日の入り位置をマーク
- **表示情報**:
  - 日の出時刻
  - 日の入り時刻
  - 南中時刻（太陽が最も高い時）
  - 太陽高度（角度）
  - 方位角
  - 昼の長さ
- **アニメーション**: 時間スライダー移動時、太陽がスムーズに移動

#### 3.1.4 AI生成コンテンツ（Google AI Studio）
- **生成タイミング**: 生成ボタンを押した時（手動トリガー）
- **キャッシュ**: 利用しない（毎回新しいコンテンツを生成）
- **生成内容**:
  1. **太陽にまつわる豆知識・神話**
     - その日の太陽に関連する知識
     - 文化・神話・科学的知識
  2. **メッセージ**
     - その日の太陽に合わせたメッセージ
     - 前向きなトーン
  3. **日焼け対策・紫外線アドバイス**
     - 時期・時間帯に応じたアドバイス
     - 紫外線指数情報（模擬）
  4. **写真撮影ベストタイミング**
     - 朝焼け・夕焼けの時間帯
     - ゴールデンアワー・マジックアワー
     - 撮影のヒント

### 3.2 データ保存（ローカルストレージ）
- 選択中の都市（または緯度経度）
- 閲覧履歴（最新10件）
- お気に入り日付・時刻
- APIキー（ユーザー設定）

---

## 4. 非機能要件

### 4.1 デザイン要求
- **テーマ**: 時間帯に応じた色変化（動的）
- **方向性**: リッチな表現、視覚的な美しさ
- **31番との統一感**:
  - 共通のフォント・レイアウト
  - 共通ナビゲーション
  - 類似のUI要素
- **アニメーション**:
  - 太陽の移動
  - 空の色のグラデーション遷移
  - UIトランジション

### 4.2 パフォーマンス
- 初回表示: 2秒以内
- Canvas描画: 60fps維持
- AI生成: バックグラウンド実行、ローディング表示

### 4.3 互換性
- モダンブラウザ（Chrome, Edge, Safari, Firefox最新版）
- モバイル・タブレット対応
- PWAとしてインストール可能

---

## 5. 技術制約

### 5.1 使用API
- **Google AI Studio API**
  - モデル: Gemini Pro推奨
  - APIキー管理: ユーザー入力 + ローカルストレージ
  - 31番と共通

### 5.2 データ保存
- **ローカルストレージ**
  - 容量制限: 5MB以内
  - データ構造: JSON形式

### 5.3 天文計算
- 太陽位置計算アルゴリズム実装
- SunCalc.jsライブラリ使用推奨
- 白夜・極夜の特殊ケース対応

---

## 6. 画面構成

### 6.1 メイン画面
```
┌─────────────────────────────────────┐
│  ☀️ 太陽の動き表示                   │
├─────────────────────────────────────┤
│  📍 都市: [東京 ▼]  緯度経度手動入力  │
│  📅 [カレンダー: 2025年1月]  ◀ ▶    │
│  🕐 時刻: [15:00] ━━━●━━━━━ [24:00]│
├─────────────────────────────────────┤
│                                     │
│      [Canvas: 太陽と空の描画]        │
│     （時間帯で空の色変化）             │
│      太陽の軌跡（東→西）              │
│                                     │
│  📊 日の出: 06:45  日の入り: 16:45  │
│     南中: 11:45   昼の長さ: 10h     │
│     太陽高度: 35°  方位角: 180°     │
│                                     │
├─────────────────────────────────────┤
│  [✨ AI情報を生成 ボタン]             │
├─────────────────────────────────────┤
│  💡 豆知識:                          │
│  [AI生成コンテンツ]                  │
├─────────────────────────────────────┤
│  🔮 今日のメッセージ:                 │
│  [AI生成コンテンツ]                  │
├─────────────────────────────────────┤
│  🧴 日焼け対策:                       │
│  [AI生成コンテンツ]                  │
├─────────────────────────────────────┤
│  📸 撮影ベストタイミング:              │
│  [AI生成コンテンツ]                  │
└─────────────────────────────────────┘
```

### 6.2 設定画面
- APIキー入力
- 都市リスト編集
- データクリア
- アプリ情報

---

## 7. 開発スコープ外（将来拡張）

- リアルタイム通知（日の出アラート）
- 天気API連携（雲量情報）
- 31番との統合ビュー（月と太陽の位置関係）
- ソーシャル共有機能
- AR機能（カメラで実際の空に太陽位置を重ねる）

---

## 8. リスクと対策

### 8.1 技術リスク
| リスク | 対策 |
|--------|------|
| Canvas描画パフォーマンス低下 | 最適化、描画頻度制御 |
| 白夜・極夜の計算複雑性 | SunCalc.jsライブラリ使用 |
| AI生成の遅延 | ローディング表示、タイムアウト設定 |
| 時間帯による色変化の実装 | グラデーション事前定義 |

### 8.2 運用リスク
| リスク | 対策 |
|--------|------|
| APIキー未設定時のUX | デモモード・プレースホルダー表示 |
| API利用制限超過 | ローカルキャッシュ、リトライ機構 |
| 位置情報の精度 | 主要都市の緯度経度を正確に設定 |

---

## 9. 31番アプリとの共通化

### 9.1 共通要素
- Canvas描画基盤
- 日付選択UI（カレンダー）
- AI生成ボタン・表示セクション
- ローカルストレージ管理
- PWA設定
- ナビゲーションバー
- デザインシステム（色・フォント）

### 9.2 差分要素
- **32番固有**:
  - 時間選択スライダー
  - 位置情報選択
  - 太陽軌跡描画
  - 空の色変化ロジック
  - 太陽位置計算（SunCalc.js）

---

## 10. 次ステップ

1. ✅ 要件定義書レビュー・承認
2. ⬜ 技術設計書作成
3. ⬜ 実装計画書作成
4. ⬜ 実装開始（Claude Code on the Web）

---

**作成者**: クロ
**レビュー待ち**: あおいさん
